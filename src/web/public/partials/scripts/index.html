<script
  async
  src="https://cdn.jsdelivr.net/npm/es-module-shims@1/dist/es-module-shims.min.js"
  crossorigin="anonymous"
></script>
<script type="importmap">
  {
    "imports": {
      "@popperjs/core": "https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/esm/popper.min.js",
      "bootstrap": "https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.esm.min.js"
    }
  }
</script>

<script type="module">
  import "/components/switch.js";
  import "/components/input.js";
  import '/lib/tooltip.js';
  import { patchConfig, extractChangedConfig } from '/lib/patch.js';
  import { elements, setValueInElements, configFromElements } from '/components/elements.js';

  const config = {
    WEB_SERVER_ENABLED: {{.CONFIG.WEB_SERVER_ENABLED}},
    WEB_SERVER_PORT: {{.CONFIG.WEB_SERVER_PORT}},

    LANGUAGE: "{{.CONFIG.LANGUAGE}}",

    DISCORD_BOT_ENABLED: {{.CONFIG.DISCORD_BOT_ENABLED}},
    DISCORD_BOT_TOKEN: "{{.CONFIG.DISCORD_BOT_TOKEN}}",
    DISCORD_ADMIN_USERNAMES: "{{.CONFIG.DISCORD_ADMIN_USERNAMES}}",
    DISCORD_COMMAND_CASE_SENSITIVE: {{.CONFIG.DISCORD_COMMAND_CASE_SENSITIVE}},
    DISCORD_COMMAND_PREFIX: "{{.CONFIG.DISCORD_COMMAND_PREFIX}}",

    PALWORLD_RCON_ENABLED: {{.CONFIG.PALWORLD_RCON_ENABLED}},
    PALWORLD_RCON_HOST: "{{.CONFIG.PALWORLD_RCON_HOST}}",
    PALWORLD_RCON_PORT: {{.CONFIG.PALWORLD_RCON_PORT}},
    PALWORLD_ADMIN_PASSWORD: "{{.CONFIG.PALWORLD_ADMIN_PASSWORD}}",
    PALWORLD_SERVER_FILE_PATH: "{{.CONFIG.PALWORLD_SERVER_FILE_PATH}}",
    PALWORLD_SERVER_EXECUTE_FLAGS: "{{.CONFIG.PALWORLD_SERVER_EXECUTE_FLAGS}}",
    PALWORLD_SERVER_SETTINGS_FILE_PATH: "{{.CONFIG.PALWORLD_SERVER_SETTINGS_FILE_PATH}}",

    DISCORD_DASHBOARD_CHANNEL_ID: "{{.CONFIG.DISCORD_DASHBOARD_CHANNEL_ID}}",
    DISCORD_LOG_CHANNEL_ID: "{{.CONFIG.DISCORD_LOG_CHANNEL_ID}}",
    DISCORD_DASHBOARD_ONLINE_PLAYERS_MESSAGE_ID: "{{.CONFIG.DISCORD_DASHBOARD_ONLINE_PLAYERS_MESSAGE_ID}}",
    DISCORD_DASHBOARD_PALWORLD_CONFIG_MESSAGE_ID: "{{.CONFIG.DISCORD_DASHBOARD_PALWORLD_CONFIG_MESSAGE_ID}}",
    DISCORD_DASHBOARD_BOT_CONFIG_MESSAGE_ID: "{{.CONFIG.DISCORD_DASHBOARD_BOT_CONFIG_MESSAGE_ID}}",

    DISCORD_COMMAND_ALIAS_HELP: "{{.CONFIG.DISCORD_COMMAND_ALIAS_HELP}}",
    DISCORD_COMMAND_ALIAS_KICK: "{{.CONFIG.DISCORD_COMMAND_ALIAS_KICK}}",
    DISCORD_COMMAND_ALIAS_BAN: "{{.CONFIG.DISCORD_COMMAND_ALIAS_BAN}}",
    DISCORD_COMMAND_ALIAS_BROADCAST: "{{.CONFIG.DISCORD_COMMAND_ALIAS_BROADCAST}}",
    DISCORD_COMMAND_ALIAS_SHUTDOWN: "{{.CONFIG.DISCORD_COMMAND_ALIAS_SHUTDOWN}}",
    DISCORD_COMMAND_ALIAS_DO_EXIT: "{{.CONFIG.DISCORD_COMMAND_ALIAS_DO_EXIT}}",
    DISCORD_COMMAND_ALIAS_SAVE: "{{.CONFIG.DISCORD_COMMAND_ALIAS_SAVE}}",
    DISCORD_COMMAND_ALIAS_START_SERVER: "{{.CONFIG.DISCORD_COMMAND_ALIAS_START_SERVER}}",
    DISCORD_COMMAND_ALIAS_SERVER_SETTINGS: "{{.CONFIG.DISCORD_COMMAND_ALIAS_SERVER_SETTINGS}}",
  };

  setValueInElements(config);

  document.querySelectorAll(".patch-config").forEach((el) => {
    el.addEventListener("click", () => {
      const changedConfig = extractChangedConfig(configFromElements(), config);
      patchConfig(changedConfig, "{{.i18n.ConfigUpdateSuccess}}", "{{.i18n.ConfigUpdateFailed}}");
    })
  })
</script>
